!function(global){function _removeComments(e){return e.replace("(/*([^*]|[\r\n]|(*+([^*/]|[\r\n])))**+/)|(//.*)")}function _generateGuid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function _loadModule(moduleName,callback){var module=_modules[moduleName];void 0===module?goat.http.get(goat.moduleDir+"/"+moduleName+".js",function(er,data){var fn="(function(){ var module; "+_removeComments(data)+" return module;})()";_modules[moduleName]=eval(fn),callback()}):callback()}function createTag(e,t,n,r){function a(){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=u+".css",t.appendChild(e),l.css=u+".css"}function o(e){var t=0;n.forEach(function(e){_loadModule(e,function(){t++})});var r=setInterval(function(){t===n.length&&(clearInterval(r),e())})}function i(){goat.http.get(u+".js",function(t,n){if(t)return console.error("goat: error loading "+e+".js\n",n);var a=goat.TagEnvironment(goat.get("%"+c),c,l.$html,_removeComments(n),_modules);l.tag=a,a.start(),r&&r()}),l.script=u+".js"}n=n||[];var l={};t instanceof HTMLElement||(t=t||window.event,t=t.target);var u=goat.tagDir+"/"+e+"/"+e,c=_generateGuid();return t.dataset.guiId=c,function(e){goat.http.get(u+".html",function(n,r){l.$html=(t.innerHTML+"").replace(/\r?\n|\r/g),t.innerHTML=r,e()}),l.template=u+".html"}(function(){var e=document.createElement("img");e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.onload=function(){a(),o(i),goat.getUnder(t,"_goat").forEach(function(e){var t=e.getAttribute("goat")||[];"string"==typeof t&&(t=t.split(",")),createTag(e.localName,e,t)}),e.parentNode.removeChild(e)},t.appendChild(e)}),l}function stopTag(e){e.tag.stop()}function stopModule(e){delete _modules[e]}function start(){(goat.get("_goat")||[]).forEach(function(e){goat.createTag(e.localName,e)}),goat.loadScript(goat.init)}var core=Array.from(document.getElementsByTagName("script")).find(function(e){return e.src.includes("goat.js")}),goat={extend:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},showLog:!0,loaded:0,tagDir:core.attributes["tag-dir"].value,init:core.attributes.init.value,moduleDir:core.attributes["module-dir"].value,isLoaded:function(e){return void 0!==Array.from(document.getElementsByTagName("script")).find(function(t){return t.src===e})},loadScript:function(e,t){if(this.isLoaded(e))t();else{var n=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=function(){t&&t(),goat.loaded++},r.onload=function(){t&&t(),goat.loaded++},n.appendChild(r)}},log:function(e,t){this.showLog&&console.log(e,t)}},http={get:function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(e){4===n.readyState&&(200===n.status?t(void 0,n.responseText):t(n.statusText))},n.onerror=function(e){t(n.statusText)},n.send(null)}};goat.extend({http:http}),goat.TagEnvironment=function($tag,$guid,$html,$jstemplate,$modules){function parseExpression(e){return(e=e||"").includes("$:")||e.includes("$index:")?"":e.split("$$").join("$env.")}function getUnderEnvBy(e){return goat.filterByAttribute(goat.getUnderEnv($tag)||[],e)}function $link(){$intervalfn.push(function(){var ar=getUnderEnvBy("link");ar.forEach(function(ele){ele.innerText!==eval(parseExpression(ele.getAttribute("link")))&&(ele.innerText=eval(parseExpression(ele.getAttribute("link"))))})})}function $bind(){$intervalfn.push(function(){getUnderEnvBy("bind").forEach(function(e){$env[e.getAttribute("bind")]!==e.value&&($env[e.getAttribute("bind")]=e.value)})})}function $if(){function toTemplate(e,t){var n=document.createElement("if");templates.push({temp:n,ele:e,fn:t}),e.parentElement.replaceChild(n,e)}var templates=[];$intervalfn.push(function(){var ar=getUnderEnvBy("if");ar.find(function(ele){if(!eval(parseExpression(ele.getAttribute("if"))))return toTemplate(ele,parseExpression(ele.getAttribute("if"))),!0}),templates.forEach(function(template){eval(template.fn)&&(template.temp.parentElement.replaceChild(template.ele,template.temp),templates.splice(templates.indexOf(template),1),update())})})}function $for(){function e(e,t,n,r,a,o){var i=e.cloneNode(!0);i.removeAttribute("for");var l=goat.allUnder(i);if(l.push(i),l.forEach(function(e){Array.from(e.attributes).forEach(function(e){e.value=e.value.split("$:"+n).join("$$"+r+"["+a+"]"),e.value=e.value.split("$index:").join(a)})}),t.appendChild(i),o.push(i),i.hasAttribute("goat")){var u=i.getAttribute("goat")||[];"string"==typeof u&&(u=u.split(",")),goat.createTag(i.localName,i,u)}update()}var t=[];$intervalfn.push(function(){getUnderEnvBy("for").forEach(function(e){var n=e.getAttribute("for").split(":"),r=n[0],a=n[1],o=document.createElement("for");e.parentElement.replaceChild(o,e),t.push({ele:e,forEle:o,arrName:r,varName:a,clones:[]})}),t.forEach(function(t){var n=$env[t.arrName];if(n){for(;t.clones.length<n.length;)e(t.ele,t.forEle,t.varName,t.arrName,t.clones.length,t.clones);for(;t.clones.length>n.length;){var r=t.clones[t.clones.length-1];t.clones.splice(t.clones.indexOf(r),1),r.remove()}}})})}function handleClick(ele){return function(event){eval(parseExpression(ele.getAttribute("click")))}}function $click(){var e=getUnderEnvBy("click");$private.click&&$private.click.forEach(function(e){e.ele&&e.ele.removeEventListener("click",e.fn)}),$private.click=[],e.forEach(function(e){var t=handleClick(e);e.addEventListener("click",t),$private.click.push({fn:t,ele:e})})}function update(){$click()}function start(){$for(),$if(),$link(),$bind(),eval($jstemplate),update()}function stop(){clearInterval($interval)}var $env={},$private={},$intervalfn=[],$interval=setInterval(function(){$intervalfn.forEach(function(e){e()})},100);return{start:start,update:update,stop:stop,el:$tag}};var subscriptions={},handler={broadcast:function(e,t){subscriptions[e]||(subscriptions[e]=[]),subscriptions[e].forEach(function(e){e(t)})},subscribe:function(e,t){subscriptions[e]||(subscriptions[e]=[]),subscriptions[e].push(t)}};goat.extend({events:handler});var gui={get:function(e){if(e.includes("#"))return document.getElementById(e.replace("#",""));if(e.includes("."))return Array.from(document.getElementsByClassName(e.substr(1)));if(e.includes("%"))return Array.from(document.querySelectorAll("[data-gui-id='"+e.substr(1)+"']"))[0];if(e.includes("_"))return Array.from(document.querySelectorAll("["+e.substr(1)+"]"));var t=Array.from(document.getElementsByTagName(e));return 1===t.length?t[0]:t},under:function(e){return Array.from(e.children)},allUnder:function(e){return Array.from(e.querySelectorAll("*"))},getUnder:function(e,t,n){if(e){var r=n?this.under(e):this.allUnder(e),a=t.substr(0,1),o=t.substr(1);return"#"===a?r.find(function(e){return e.id===o}):"."===a?r.filter(function(e){return e.className.includes(o)}):"%"===a?r.find(function(e){return e.dataset["gui-id"]===o}):"_"===a?Array.from(e.querySelectorAll("["+t.substr(1)+"]")):r.filter(function(e){return e.tagName.toLowerCase()==t})}},getUnderEnv:function(e,t){function n(){var e=[];return a.forEach(function(n){n.hasAttribute("goat")?(a.splice(a.indexOf(n),1),t&&r.push(n)):e=e.concat(Array.from(n.children))}),r=r.concat(a),(a=e).length>0?n():r}if(t=t||!0,e){var r=[],a=Array.from(e.children);return n()}},filterByAttribute:function(e,t){return e.filter(function(e){return e.hasAttribute(t)})}};goat.extend(gui);var _modules={};goat.extend({createTag:createTag,stopTag:stopTag,stopModule:stopModule});var router={currentTag:void 0,routes:{},addRoute:function(e,t,n){goat.router.routes[e]={tagName:t,modules:n}},el:null,load:function(){var e=goat.router;e.el=e.el||goat.get("router");var t=location.hash.slice(1)||"/",n=e.routes[t];if(e.el&&n){var r=document.createElement(n.tagName);if(e.currentTag){goat.stopTag(e.currentTag);var a=e.currentTag.tag.el;a.parentElement.replaceChild(r,a)}else e.el.appendChild(r);e.currentTag=goat.createTag(n.tagName,r,n.modules)}},start:function(){window.addEventListener("hashchange",goat.router.load),window.addEventListener("load",goat.router.load),goat.router.load()}};goat.extend({router:router}),window.addEventListener("load",start),global.goat=goat}(window);